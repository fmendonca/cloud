---
  - hosts: localhost
    connection: local
    collections:
    - azure.azcollection
    tasks:

      - name: Create subnets Master
        azure_rm_subnet:
          resource_group: "{{ rsg_name }}"
          virtual_network_name: "{{ vnet_name }}"
          name: "master-{{ cluster_name }}"
          address_prefix_cidr: "{{ master_cidr_subnet }}"
          private_link_service_network_policies: Disabled
          state: present

      - name: Create subnets Worker
        azure_rm_subnet:
          resource_group: "{{ rsg_name }}"
          virtual_network_name: "{{ vnet_name }}"
          name: "worker-{{ cluster_name }}"
          address_prefix_cidr: "{{ worker_cidr_subnet }}"
          state: present

      - name: Create openshift cluster 
        azure_rm_openshiftmanagedcluster:
          resource_group: "{{ rsg_name }}"
          name: "{{ cluster_name }}"
          api_server_profile:
            visibility: "{{ api_visibility }}"
          ingress_profiles:
            visibility: "{{ ingress_visibility }}"
          cluster_profile:            
            resource_group_id: "{{ rsg_name }}"
          network_profile:
            pod_cidr: "{{ pod_cidr }}"
            service_cidr: "{{ service_cidr }}"
          worker_profiles:
            - vm_size : "{{ instance_type_worker }}"
              subnet_id : "worker-{{ cluster_name }}"
              disk_size : "{{ worker_disk_size }}"
              count : "{{ worker_count }}" 
          master_profile:
            vm_size : "{{ instance_type_master }}"
            subnet_id: "master-{{ cluster_name }}"